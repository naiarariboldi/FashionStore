{% extends 'base.html' %}
{% block content %}
<h2>Seu carrinho</h2>
<form method="POST" action="{{ url_for('store.update_cart') }}">
<table class="table">
<thead>
  <tr><th>Produto</th><th>Preço</th><th>Qtd</th><th>Total</th></tr>
</thead>
<tbody>
{% for it in items %}
<tr>
  <td>
    <img src="{{ it.product.image_url }}" width="40"> {{ it.product.name }}<br>
    <small>{{ it.product.description }}</small>
  </td>
  <td>R$ {{ '%.2f' % it.product.price_brl }}</td>
  <td style="max-width:100px;">
    <input type="number" class="form-control" name="qty_{{ it.id }}" value="{{ it.quantity }}">
  </td>
  <td>R$ {{ '%.2f' % (it.product.price_brl * it.quantity) }}</td>
</tr>
{% endfor %}
</tbody>
</table>
<button class="btn btn-primary">Atualizar Carrinho</button>
</form>

<p class="mt-3 fs-5">Total: <strong>R$ {{ '%.2f' % (total_cents/100) }}</strong></p>

<div class="d-flex gap-2 flex-wrap">
  <form method="POST" action="{{ url_for('store.clear_cart') }}">
    <button class="btn btn-outline-secondary">Limpar</button>
  </form>

  <form method="POST" action="{{ url_for('store.checkout_stripe') }}">
    <button class="btn btn-success">Checkout com Stripe</button>
  </form>
  <div id="paypal-button-container"></div>
  <div id="paypal-button-card"></div>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=test&currency=BRL"></script>
<script>
  paypal.Buttons({
    style: { layout: 'vertical', color: 'gold', label: 'paypal' },
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{ amount: { value: '{{ total_cents / 100 }}' } }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        alert('Pagamento aprovado por ' + details.payer.name.given_name);
      });
    }
  }).render('#paypal-button-container');

  paypal.Buttons({
    style: { layout: 'vertical', color: 'black', label: 'card' },
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{ amount: { value: '{{ total_cents / 100 }}' } }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        alert('Pagamento com cartão aprovado por ' + details.payer.name.given_name);
      });
    }
  }).render('#paypal-button-card');
</script>
{% endblock %}
